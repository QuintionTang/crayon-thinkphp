function CustomTable(t){var e,a=this;this._selector=t,this._data_attrs=function(t){var e=t.data()||{},a=_.map(_.split(e.unorder,","),function(t){return _.toNumber(t)}),n=e.csort,t=e.corder||"asc",e={};_.isNumber(n)&&(e={aoColumnDefs:[{bSortable:!1,aTargets:a}],sort:!0,order:[[n,t]]});return e}(t),this._options=(e=this._data_attrs,_.assign({processing:!0,lengthChange:!1,aTargets:[],order:!1,sort:!1,scroll:!1,info:!1,pageLength:20,paging:!1,filter:!1,oLanguage:{sLengthMenu:"每页显示 _MENU_ 条记录",sZeroRecords:"暂无任何数据记录",sInfo:"当前显示 _START_ 到 _END_ 条，共 _TOTAL_条记录",sInfoEmtpy:"找不到相关数据",sInfoFiltered:" 数据表中共为 _MAX_ 条记录",sProcessing:"数据加载中...",sSearch:"搜索",oPaginate:{sFirst:"第一页",sPrevious:" 上一页 ",sNext:" 下一页 ",sLast:" 最后一页 "}}},e)),this.init=function(){var c,t=_.assign({},a._options);this._selector.DataTable(t),this._selector.editTable(),this._selector.data().istree&&(c=this._selector,console.log("dddd"),c.treetable({expandable:!0}).treetable("expandAll"),c.on("click",".TreeCheckbox",function(){for(var t=$(".TreeCheckbox",c),e=t.length,a=t.index($(this)),n=t.eq(a).attr("level"),o=t.eq(a).attr("level"),i=a;0<=i;i--){var r=t.eq(i).attr("level");parseInt(r)<parseInt(n)&&(t.eq(i).prop("checked",!0),--n)}for(var s=a+1;s<e;s++){var l=t.eq(s).attr("level");if(t.eq(a).prop("checked")){if(parseInt(l)>parseInt(o))t.eq(s).prop("checked",!0);else if(parseInt(l)==parseInt(o))break}else if(parseInt(l)>parseInt(o))t.eq(s).prop("checked",!1);else if(parseInt(l)==parseInt(o))break}}))}}function Form(s){var l=this;function c(e){var a=$(".alert-text",e);this.show=function(t){a.html(t),e.slideDown()},this.hide=function(){e.hide(),a.html("")}}function u(t,e){return t=parseFloat(t),+parseFloat(t.toPrecision(e))}function r(t){var r,s=$(".dropify",t);0<s.length&&(r=$(".dropify-loader",t),s.dropify({tpl:{loader:'<div class="dropify-loader"></div>'},messages:{default:"点击或拖拽文件到这里",replace:"点击或拖拽文件到这里来替换文件",remove:"移除文件",error:"对不起，你上传的文件太大了"}}),r.hide(),s.change(function(){var e,a,t=new FormData,n=s.data(),o=n.successMessage,i=s[0].files[0];t.append("file",i),r.show(),i=t,t=n.uploadUrl,n=n.targetid,e=o,a=$(n),$.ajax({url:t,type:"post",data:i,contentType:!1,processData:!1,dataType:"json",success:function(t){t&&0<t.success?t.count?(g(),m((e||"成功导入工人信息")+"："+t.count+"！","",function(){window.location.reload()})):a&&0<a.length&&a.val(t.attach_id):b(t.message||"服务器异常！"),$(".dropify-loader").hide()}})}))}function d(t,e){var r={};t.forEach(function(t){var e=$(t.element).data(),a=e.type||"string",n=t.element.name,o=e.group,i=t.value,i=(i=t=i,i="number"===a?_.isArray(i)?_.map(i,function(t){return _.toNumber(t)}):_.toNumber(i):t);o?(e=e.name,_.isArray(i)?r[e]?r[e]=_.concat(r[e],i):r[e]=i:r[e]?r[e].push(i):r[e]=[i]):""!=n&&"array"!=a&&(r[n]=i)});var a,n=$(".repeater-params",e);return n&&0<n.length&&(a=n.data("name"),t=n.data("target"),e=n.data("type"),n=n.repeaterVal(),r&&n&&n[t]&&(r[a]="string"==e?JSON.stringify(n[t]):n[t])),r}function f(t){var e,a=$(".ajax-select",t);0<a.length&&(e="ajax-select-val",a=(t=a).parent(),a=$("input."+e,a),t.ajax_select({field:a}))}function h(t){var r,e,t=$(".unionSelect",t);0<t.length&&(i=t.data(),r=$(i.target),e=i.uri,t.unbind("change").bind("change",function(){var t=$(this).val();"0"==t&&""==t||$.getJSON(e,{id:t},function(t){if(t.status){var e=t.data,a=[];a.push('<option value="0">-- 请选择石头尺寸 --</option>');for(var n=0,o=e.length;n<o;n++){var i=e[n];a.push('<option title="'+i.size_weight+'" value="'+i.id+'">'+i.size_value+"（mm）："+i.size_weight+"（ct）</option>")}r.html(a.join("")).show()}})}));var a,n,o,i=$("#jewel_size_box");0<i.length&&(n=a=0,t=$("#actual_count"),o=$("#actual_weight"),i.on("select2:select",function(t){t=t.params.data.title;a=u(t,3),o.val(u(n*a))}),t.unbind("input propertychange").bind("input propertychange",function(){n=u($(this).val()),o.val(u(n*a))}))}function p(t,e,a){var n,o=[];for(n in e)o.push([n,"=",encodeURIComponent(e[n])].join(""));var i=$.Deferred(),t={type:a||"POST",url:t,contentType:"application/x-www-form-urlencoded",success:function(t){i.resolve(t,!1)},error:function(t){i.resolve(!1,{status:t.status||0,code:-1,message:b(t)})}};return e&&(t.data=o.join("&")),$.ajax(t),i.promise()}function m(t,e,a){var n=!1,o='<strong><i class="number">2秒</i>后将自动关闭！</strong>';""!==e?e+="<br/>"+o:e=o;var i=(t={heading:t,text:e,position:"top-right",loaderBg:"#5ba035",icon:"success",hideAfter:2e3||3e3,stack:1||1,beforeHidden:t=function(){n&&(clearTimeout(n),n=!1),i.close(),a.call()}},(e="slide")&&(t.showHideTransition=e),$.toast().reset("all"),$.toast(t));setTimeout(function(){i.close(),a.call()},1e3)}function g(){l._modalHelper&&l._modalHelper.closethis&&l._modalHelper.closethis()}function v(t){var e,a;1==t.status?(g(),(e="")!==(a=t.data)&&a.url&&(e=a.url),m("操作成功！",t.msg,function(){""!==e?window.location.href=e:window.location.reload(),l._submit_ladda&&l._submit_ladda.stop()})):(2==t.status?l._modalHelper.update(t.data):b(t.msg),l._submit_ladda&&l._submit_ladda.stop())}function b(t){!1!==l._elem_form?l.error(t,l._elem_form):console.error(t),l._submit_ladda&&l._submit_ladda.toggle()}this._modalHelper=!1,this._elem_form=!1,this._submit_ladda=!1,this.init=function(){var t;((t=!1)?$(".form-parsley",t):$(".form-parsley")).each(function(t,e){var a=$(e),n=$(".ladda-button",a),e=["#",a.attr("id")].join(""),o=!1,i=new c($(".alert-form-box",a)),r=a.attr("name");0<n.length&&(o=Ladda.create(document.querySelector(e+" .ladda-button"))),l._submit_ladda=o,a.parsley().on("form:submit",function(t,e){return!1}).subscribe("form:submit",function(t,e){return o&&o.toggle(),i.hide(),"function"==typeof s[r]&&s.init(i,o,a)[r](d(e.fields,a)),!1}),f(a),h(a)})},this.reset=function(t,e){var a,n,o,i;this._modalHelper=e,r(this._elem_form=t),a=$(".modal-body",t),n=$('[data-plugin="daterangepicker"]',a),e=$('[data-plugin="daterangepickertime"]',a),o=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],i=["周日","周一","周二","周三","周四","周五","周六"],0<n.length&&n.each(function(t){$(this).daterangepicker({parentEl:a,singleDatePicker:!0,showDropdowns:!0,locale:{format:"YYYY-MM-DD",applyLabel:"确定",cancelLabel:"取消",monthNames:o,daysOfWeek:i},minYear:parseInt(moment().add(-1,"years").format("YYYY"),10),maxYear:parseInt(moment().add(2,"years").format("YYYY"),10),autoApply:!0,opens:"left"},function(t,e,a){})}),0<e.length&&e.each(function(){$(this).daterangepicker({parentEl:a,singleDatePicker:!0,showDropdowns:!0,timePicker:!0,minYear:2021,timePicker24Hour:!0,locale:{format:"YYYY-MM-DD hh:mm",applyLabel:"确定",cancelLabel:"取消",monthNames:o,daysOfWeek:i},autoApply:!0,opens:"left"},function(t,e,a){})}),function(t){t=l._elem_form=t,0<$("form",t).length&&t.each(function(t,e){var a=$("form",e),n=$(".ladda-button",a),e=["#",e.id+" .ladda-button"].join(""),o=!1,i=new c($(".alert-form-box",a)),r="1"!=$("input[name='ajax']",a).val();a.attr("data-action");0<n.length&&(o=Ladda.create(document.querySelector(e))),l._submit_ladda=o,a.parsley({trigger:"focusout"}).on("form:submit",function(t,e){return r}).subscribe("form:submit",function(t,e){o&&o.toggle(),i.hide();e=d(e.fields,a);return p(a.attr("action"),e).then(function(t,e){e?console.log(e):v(t)}),!1}),$(e).unbind("click").bind("click",function(){a.submit()}),f(a)}),0<$('[data-plugin="multiselect"]').length&&$('[data-plugin="multiselect"]').multiSelect($(this).data())}(t),h(t),$(".select2",t).select2({dropdownAutoWidth:!0,language:{errorLoading:function(){return"无法载入结果。"},inputTooLong:function(t){return"请删除"+(t.input.length-t.maximum)+"个字符"},inputTooShort:function(t){return"请再输入至少"+(t.minimum-t.input.length)+"个字符"},loadingMore:function(){return"载入更多结果…"},maximumSelected:function(t){return"最多只能选择"+t.maximum+"个项目"},noResults:function(){return"未找到相应的选项"},searching:function(){return"搜索中…"},removeAllItems:function(){return"删除所有项"}}})},this.error=function(t,e){new c($(".alert-form-box",e)).show(t)},this.hideError=function(t){new c($(".alert-form-box",t)).hide()},this.success=function(t,e,a){m(t,e,a)},this.ajax=function(t,e){p(t,e).then(function(t,e){e?console.log(e):v(t)})},this.submitForm=function(t,e,a){p(t,e).then(function(t,e){a(t,e)})}}function CusModal(t){var r=this;this._formHelper=t,this._modal=!1,this._primary=!1,this._isShow=!1,this._close_status=!0,this._eBody=!1,this._eModal=!1,this.setPrimary=function(t){this._primary=t},this.close=function(){Custombox.modal.closeAll(),r._isShow=!1},this.closethis=function(){Custombox.modal.close(),r._isShow=!1},this.update=function(t){r._eBody.html(t),r._formHelper.reset(r._eModal,r)},this.before=function(t,e){},this.canClose=function(t){this._close_status=t},this.init=function(t){$('.events-button[data-plugin="custommodal"]',t||"body").unbind("click").bind("click",function(t){t.preventDefault();var e=$(this),a=e.data(),n=a.targetid||e.attr("href"),o=$(n),i=$(".custom-modal-title",o),t=$(".modal-header button.close",o);r._close_status?t.show():t.hide(),a.eBody=$(".modal-body",o),r._eBody=a.eBody,a.eModal=o,r._eModal=o,a.mybtn=e,i.text(a.title),a.primaryInfo=r._primary||a.id,r.before(a,function(){r._isShow=!0,r._modal=new Custombox.modal({content:{target:n,effect:a.animation,onClose:function(){r._eBody.html(""),r._isShow=!1}},loader:{color:"#0077ff"},overlay:{color:a.overlaycolor,close:!1}}),r._modal.open()})})}}function Ui(){var n=new function(){var e=new Form;this.login=function(t){e.reset($("#auth-page"))},this.logout=function(t){e.ajax(t,{request:"logout"})}};function o(){var o,i=new Form;0<$("a.events-button").length&&((o=new CusModal(i)).before=function(e,a){var n;"ajax"===e.acttype&&(n=e.uri,e.confirm&&"confirm"==e.confirm?swal.fire({title:e.msg,html:"删除后内容无法恢复！",type:"warning",showCancelButton:!0,confirmButtonColor:"#5c90d2",confirmButtonText:"确定删除",cancelButtonColor:"#f5f5f5",cancelButtonText:"取消",onClose:!1}).then(function(t){t.value&&$.getJSON(n,function(t){1==t.status?i.success("操作成功！",t.msg,function(){window.location.reload()}):swal.fire("操作失败",t.msg,"error")})}):$.getJSON(n,function(t){1==t.status?(e.eBody.html(t.data),i.reset(e.eModal,o),r(e.eBody),t=e.eBody,(t=$(".repeater-custom-form",t))&&0<t.length&&t.repeater({show:function(){$(this).slideDown()},hide:function(t){confirm("确定要删除这一条？")&&$(this).slideUp(t)}}),a.call()):console.log("error")}))},o.init());var t=$(".ajax-post-body");0<t.length&&i.reset(t)}function r(t){t=$(".custom-table",t);_.forEach(t,function(t){new CustomTable($(t)).init()})}this.init=function(t,e){var a;"function"==typeof n[t]&&n[t].call(null,e),o(),0<(a=$("form.search-form")).length&&$("select",a).each(function(t,e){$(e).bind("change",function(){var t=$(this).val();"0"==t&&""==t||a.submit()})}),r($(".page-content"))},this.logout=function(t){n.logout(t)}}$.fn.ajax_select=function(t){var o=this,e=$.extend({field:$("#OD_ajax_select"),disabled:!1,top_option_id:0,top_option:"请选择"},t||{}),a=$(this),i=a.attr("data-pid"),r=a.attr("data-top-option")||e.top_option,n=a.attr("data-uri"),t=a.attr("data-selected"),s=[];this._self=a,this._ajax_sel=".ajax-select",this._ajax_uri=n,null!=t&&"0"!=t&&(t.indexOf("|")?s=t.split("|"):(s=[])[0]=t),this._self.nextAll(o._ajax_sel).remove(),$('<option value="'+e.top_option_id+'">--'+r+"--</option>").appendTo(this._self),$.ajax({url:o._ajax_uri,data:{id:i},success:function(t){if("1"==t.status)for(var e=0;e<t.data.length;e++){var a=(a=t.data[e].remark)&&""!=a?"【"+a+"】":"",n=t.data[e].extend||"";$('<option data-extend="'+n+'" value="'+t.data[e].id+'">--'+a+t.data[e].name+"--</option>").appendTo(o._self)}0<s.length&&setTimeout(function(){o._self.find('option[value="'+s[0]+'"]').attr("selected",!0),o._self.trigger("change")},1)}});var l=1,c="";e.disabled&&(c=' _disabled="true"'),i&&($(document).off("change",".ajax-select"),$(document).on("change",".ajax-select",function(){var n=$(this),t=$("option:selected",n).attr("data-extend")||"";i=n.val(),n.nextAll(o._ajax_sel).remove(),0<i?($.getJSON(o._ajax_uri,{id:i,extend:t},function(t){if("1"==t.status){for(var e=$("<select "+c+' class="'+o._ajax_sel.substr(1)+' ajax-select custom-select form-control mr-2" data-pid="'+i+'"><option value="0">--'+r+"--</option></select>"),a=0;a<t.data.length;a++)$('<option value="'+t.data[a].id+'">--'+t.data[a].name+"--</option>").appendTo(e);e.insertAfter(n),null!=s[l]&&(e.find('option[value="'+s[l]+'"]').attr("selected",!0),e.trigger("change")),l++}}),e.field.val(i)):e.field.val(n.attr("data-pid"))}))},function(s){s.fn.editTable=function(t){var e=this,a=window.location.search,r={url:s(e).attr("data-acturi")};t&&s.extend(r,t);for(var n=a.substr(1).split("&"),o=0;o<n.length;o++){var i=n[o].split("=");"sort"==i[0]&&i[1],"order"==i[0]&&i[1]}s(e).on("click",'span[data-tdtype="edit"]',function(){var e=s.trim(s(this).text()),a=s(this).attr("data-field"),n=s(this).attr("data-id"),t=s(this).width(),o=s(this).hasClass("date"),i="list_table_edit_input_"+n;return $this=s(this),s(this).hide(),s(this).after('<input id="'+i+'" type="text" class="tabledit-input form-control" value="'+e+'" />'),s("#"+i).width(t).focusout(function(){var t;o||($this=s("#"+i),$this.prev("span").show().text($this.val()),$this.val()!=e&&(t=$this.val(),o&&(t=strtotime(t)),s.getJSON(r.url,{id:n,field:a,val:t},function(t){0==t.status&&s('span[data-field="'+a+'"][data-id="'+n+'"]').text(e)})),$this.remove())}).focus().select(),!1}),s(e).on("click",'a[data-tdtype="toggle"]',function(){var t=this,e=s("i",t),a=0==s(t).attr("data-value")?1:0,n=s(t).attr("data-field"),t=s(t).attr("data-id"),o=e.attr("class");return s.getJSON(r.url,{id:t,field:n,val:a},function(t){1==t.status&&(-1<o.indexOf("mdi-close-circle-outline text-danger")?e.attr({class:o.replace("mdi-close-circle-outline text-danger","mdi-checkbox-marked-circle-outline text-success"),"data-value":a}):e.attr({class:o.replace("mdi-checkbox-marked-circle-outline text-success","mdi-close-circle-outline text-danger"),"data-value":a}))}),!1})}}(jQuery),function(o){"use strict";function t(){this._ui=new Ui}function n(t,e){var a=0,n=e;return""!=t&&(e=(t=t.replace(".shtml","")).split("/"),a=0<=(t=_.findIndex(e,function(t){return t===n}))?e[t+1]:0),a}var i;t.prototype.init=function(t,e){var a,n=this;this._ui.init(t,e),a=function(t){n._ui.logout(t)},o("#button-logout").on("click",function(){var t=o(this).data();a.call(null,t.url)})},i=window.location.href.split(/[?#]/)[0],o(".navigation-menu a").each(function(){var t=n(this.href,"feature_id"),e=n(i,"parent_feature_id"),a=n(i,"feature_id");(0<t&&0<e&&t===e||0<t&&0<a&&t===a)&&(o(this).parent().addClass("active"),o(this).parent().parent().parent().parent().addClass("show"),o(this).parent().parent().addClass("show"),o(this).parent().parent().parent().addClass("active"),o(this).parent().parent().parent().parent().addClass("active"),o(this).parent().parent().parent().parent().parent().addClass("in"),o(this).parent().parent().parent().parent().parent().addClass("active"))}),o(".slimscroll").slimscroll({height:"auto",position:"right",size:"7px",color:"#ebf0f6",wheelStep:5,opacity:1,touchScrollStep:50}),o(".navbar-toggle").on("click",function(t){o(this).toggleClass("open"),o("#navigation").slideToggle(400)}),o(".navigation-menu>li").slice(-2).addClass("last-elements"),o('.navigation-menu li.has-submenu a[href="javascript:;"]').on("click",function(t){o(window).width()<992&&(t.preventDefault(),o(this).parent("li").toggleClass("open").find(".submenu:first").toggleClass("open"))}),o(".has-submenu").on("click",function(t){t.preventDefault(),o(this).addClass("active"),o(this).siblings().removeClass("active"),o(".submenu-tab").addClass("show");t=o(this).attr("href");o(t).addClass("active"),o(t).siblings().removeClass("active")}),o(".submenu li").on("click",function(t){o(this).addClass("active"),o(this).siblings().removeClass("active"),window.location.href=t.target.href}),Waves.init(),o.App=new t,o.App.Constructor=t}(jQuery);
//# sourceMappingURL=app.min.js.map
